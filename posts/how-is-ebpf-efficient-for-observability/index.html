<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How is eBPF efficient for observability</title>
<link rel="stylesheet" href="/assets/built/screen.css?v=ce0a9a97d4">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400;1,700&family=Mulish:ital,wght@0,400;0,700;0,800;1,400;1,700&display=swap">
<script>
        if (localStorage.getItem('alto_dark') == 'true') {
            document.documentElement.classList.add('dark-mode');
        }
    </script>
<meta name="description" content="A look at how eBPF efficiently facilitates  information exchanges between the user and Linux kernel space.">
<link rel="icon" href="https://digitalpress.fra1.cdn.digitaloceanspaces.com/clrvv0c/2023/04/code-branch.png" type="image/png">
<link rel="canonical" href="https://realvz.github.io/blog/how-is-ebpf-efficient-for-observability/">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta property="og:site_name" content="Re Alvarez Parmar&#x27;s Blog">
<meta property="og:type" content="article">
<meta property="og:title" content="How is eBPF efficient for observability">
<meta property="og:description" content="A look at how eBPF efficiently facilitates  information exchanges between the user and Linux kernel space.">
<meta property="og:url" content="https://realvz.github.io/blog/how-is-ebpf-efficient-for-observability/">
<meta property="og:image" content="https://images.unsplash.com/photo-1514732800601-524d62e9b8a7?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDk3fHxyZWQlMjBhbmQlMjBibHVlJTIwbGlnaHR8ZW58MHx8fHwxNjU3Mzg0NTY1&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000content/images/size/w1200">
<meta property="article:published_time" content="2022-07-09T16:37:45.000Z">
<meta property="article:modified_time" content="2022-07-09T16:40:05.000Z">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Observability">
<meta property="article:tag" content="eBPF">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="How is eBPF efficient for observability">
<meta name="twitter:description" content="A look at how eBPF efficiently facilitates  information exchanges between the user and Linux kernel space.">
<meta name="twitter:url" content="https://realvz.github.io/blog/how-is-ebpf-efficient-for-observability/">
<meta name="twitter:image" content="https://images.unsplash.com/photo-1514732800601-524d62e9b8a7?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDk3fHxyZWQlMjBhbmQlMjBibHVlJTIwbGlnaHR8ZW58MHx8fHwxNjU3Mzg0NTY1&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;2000content/images/size/w1200">
<meta name="twitter:label1" content="Written by">
<meta name="twitter:data1" content="Re Alvarez Parmar">
<meta name="twitter:label2" content="Filed under">
<meta name="twitter:data2" content="Linux, Observability, eBPF">
<meta name="twitter:site" content="@realz">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="875">
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Re Alvarez Parmar&#x27;s Blog",
        "url": "https://realvz.github.io/blog/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://digitalpress.fra1.cdn.digitaloceanspaces.com/clrvv0c/2023/04/code-branch.png",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Re Alvarez Parmar",
        "url": "https://realvz.github.io/blog/author/re-2/",
        "sameAs": []
    },
    "headline": "How is eBPF efficient for observability",
    "url": "https://realvz.github.io/blog/how-is-ebpf-efficient-for-observability/",
    "datePublished": "2022-07-09T16:37:45.000Z",
    "dateModified": "2022-07-09T16:40:05.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://images.unsplash.com/photo-1514732800601-524d62e9b8a7?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxMTc3M3wwfDF8c2VhcmNofDk3fHxyZWQlMjBhbmQlMjBibHVlJTIwbGlnaHR8ZW58MHx8fHwxNjU3Mzg0NTY1&ixlib=rb-1.2.1&q=80&w=2000content/images/size/w1200",
        "width": 1200,
        "height": 875
    },
    "keywords": "Linux, Observability, eBPF",
    "description": "A look at how eBPF efficiently facilitates  information exchanges between the user and Linux kernel space. ",
    "mainEntityOfPage": "https://realvz.github.io/blog/how-is-ebpf-efficient-for-observability/"
}
    </script>
<meta name="generator" content="Ghost 5.79">
<link rel="alternate" type="application/rss+xml" title="Re Alvarez Parmar&#x27;s Blog" href="https://realvz.github.io/blog/rss/">
<script defer src="https://cdn.jsdelivr.net/ghost/portal@~2.37/umd/portal.min.js" data-i18n="false" data-ghost="https://realvz.github.io/blog/" data-key="875679d7145ae8b3c4db5168c2" data-api="https://realvz.github.io/blog/ghost/api/content/" crossorigin="anonymous"></script><style id="gh-members-styles">.gh-post-upgrade-cta-content,
.gh-post-upgrade-cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    text-align: center;
    width: 100%;
    color: #ffffff;
    font-size: 16px;
}

.gh-post-upgrade-cta-content {
    border-radius: 8px;
    padding: 40px 4vw;
}

.gh-post-upgrade-cta h2 {
    color: #ffffff;
    font-size: 28px;
    letter-spacing: -0.2px;
    margin: 0;
    padding: 0;
}

.gh-post-upgrade-cta p {
    margin: 20px 0 0;
    padding: 0;
}

.gh-post-upgrade-cta small {
    font-size: 16px;
    letter-spacing: -0.2px;
}

.gh-post-upgrade-cta a {
    color: #ffffff;
    cursor: pointer;
    font-weight: 500;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a:hover {
    color: #ffffff;
    opacity: 0.8;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a.gh-btn {
    display: block;
    background: #ffffff;
    text-decoration: none;
    margin: 28px 0 0;
    padding: 8px 18px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
}

.gh-post-upgrade-cta a.gh-btn:hover {
    opacity: 0.92;
}</style>
<script defer src="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/sodo-search.min.js" data-key="875679d7145ae8b3c4db5168c2" data-styles="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/main.css" data-sodo-search="https://realvz.github.io/blog/" crossorigin="anonymous"></script>
<link href="https://realvz.github.io/blog/webmentions/receive/" rel="webmention">
<script defer src="/public/cards.min.js?v=ce0a9a97d4"></script>
<link rel="stylesheet" type="text/css" href="/public/cards.min.css?v=ce0a9a97d4">
<script defer src="/public/member-attribution.min.js?v=ce0a9a97d4"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-B5XRB3YVTR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B5XRB3YVTR');
</script><style>:root {--ghost-accent-color: #3a88fe;}</style>
</head>
<body class="post-template tag-linux tag-observability tag-ebpf has-serif-title has-serif-body">
<div class="site">
<header class="site-header container">
<div class="navbar">
<div class="navbar-left">
<div class="burger hidden-lg hidden-xl"></div>
<a class="logo" href="https://realvz.github.io/blog">
<span class="logo-text">Re Alvarez Parmar&#x27;s Blog</span>
</a> <div class="sep hidden-xs hidden-sm hidden-sm"></div>
<nav class="main-menu hidden-xs hidden-sm hidden-md">
<ul class="nav-list u-plain-list">
<li class="menu-item menu-item-home"><a class="menu-item-link" href="https://realvarez.com">Home</a></li>
<li class="menu-item menu-item-about"><a class="menu-item-link" href="https://realvz.github.io/blog/about/">About</a></li>
</ul>
</nav>
</div>
<div class="navbar-right">
<div class="toggle-track">
<div class="toggle-moon"><i class="icon icon-brightness-2"></i></div>
<div class="toggle-sun"><i class="icon icon-white-balance-sunny"></i></div>
<div class="toggle-thumb"></div>
</div>
</div>
</div>
</header> <div class="site-content">
<div class="content-area">
<main class="site-main">
<article class="post tag-linux tag-observability tag-ebpf single-post">
<header class="post-header big-title container medium">
<h1 class="post-title">How is eBPF efficient for observability</h1>
<div class="post-meta">
<span class="post-meta-item post-meta-date">
<time datetime="2022-07-09">Jul 9, 2022</time>
</span>
<span class="post-meta-item post-meta-length">
3 min read
</span>
<span class="post-meta-item post-meta-tags">
<a class="post-tag post-tag-linux" href="/tag/linux/" title="Linux">Linux</a><a class="post-tag post-tag-observability" href="/tag/observability/" title="Observability">Observability</a><a class="post-tag post-tag-ebpf" href="/tag/ebpf/" title="eBPF">eBPF</a>
</span>
</div>
</header> <figure class="post-media container large">
<div class="u-placeholder horizontal">
<a class="post-image-link" href="/how-is-ebpf-efficient-for-observability/">
<img class="post-image lazyload u-object-fit" data-srcset="https://images.unsplash.com/photo-1514732800601-524d62e9b8a7?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDk3fHxyZWQlMjBhbmQlMjBibHVlJTIwbGlnaHR8ZW58MHx8fHwxNjU3Mzg0NTY1&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;400 400w, https://images.unsplash.com/photo-1514732800601-524d62e9b8a7?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDk3fHxyZWQlMjBhbmQlMjBibHVlJTIwbGlnaHR8ZW58MHx8fHwxNjU3Mzg0NTY1&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;750 750w, https://images.unsplash.com/photo-1514732800601-524d62e9b8a7?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDk3fHxyZWQlMjBhbmQlMjBibHVlJTIwbGlnaHR8ZW58MHx8fHwxNjU3Mzg0NTY1&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;960 960w, https://images.unsplash.com/photo-1514732800601-524d62e9b8a7?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDk3fHxyZWQlMjBhbmQlMjBibHVlJTIwbGlnaHR8ZW58MHx8fHwxNjU3Mzg0NTY1&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;1140 1140w, https://images.unsplash.com/photo-1514732800601-524d62e9b8a7?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDk3fHxyZWQlMjBhbmQlMjBibHVlJTIwbGlnaHR8ZW58MHx8fHwxNjU3Mzg0NTY1&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;1920 1920w" data-sizes="auto" src="https://images.unsplash.com/photo-1514732800601-524d62e9b8a7?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;MnwxMTc3M3wwfDF8c2VhcmNofDk3fHxyZWQlMjBhbmQlMjBibHVlJTIwbGlnaHR8ZW58MHx8fHwxNjU3Mzg0NTY1&amp;ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;w&#x3D;960" srcset="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="How is eBPF efficient for observability">
</a>
</div>
<figcaption>Photo by <a href="https://unsplash.com/es/@rejiie?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit">Jerin J</a> / <a href="https://unsplash.com/?utm_source=ghost&utm_medium=referral&utm_campaign=api-credit">Unsplash</a></figcaption>
</figure>
<div class="post-content gh-content kg-canvas">
<blockquote>Everybody knows eBPF is fast, but how?</blockquote><p>The Berkeley Packet Filter (BPF or eBPF) is a virtual machine based on registers, initially designed for filtering network packets, best known for its use in <code>tcpdump</code>. In this post, we learn what is exactly that makes BPF so appealing for a number of use cases.</p><h2 id="introduction">Introduction</h2><p>BPF programs are small programs that run in the Linux kernel when events occur. You can think of BPF programs as event driven functions (like AWS Lambda).  BPF has access to a subset of kernel functions and memory. It is designed to be safe, that is poor BPF code won’t crash your kernel.</p><p>In the containers world, BPF is increasingly becoming relevant. Its most popular use case is Cilium, which uses eBPF to provide a <a href="https://cilium.io/blog/2021/12/01/cilium-service-mesh-beta?ref=blog.realvarez.com">“sidecarless” service mesh</a> and <a href="https://github.com/pixie-io/pixie?ref=blog.realvarez.com">Pixie</a>, which uses eBPF to collect telemetry data.</p><p>Other popular BPF uses are:</p><ul><li><strong>Debugging and Tracing -</strong> trace any <code>syscall</code> or kernel function or any user space program.</li><li><a href="https://github.com/iovisor/bpftrace?ref=blog.realvarez.com">bpftrace</a> allows users to trace from the Linux command line.</li><li><strong>Networking -</strong> Inspect, filter, manipulate traffic.</li><li>User space program can attach a filter to any socket and inspect the traffic flowing through it. They can also allow, disallow, redirect packets.</li><li><strong>Security monitoring and sandboxing</strong></li><li>BPF programs can detect and report the <code>syscalls</code> occurring on a system.</li><li>BPF programs can prevent applications from performing certain <code>syscalls</code> on a system (e.g., prevent deleting a file).</li></ul><p>Linux has allowed us to perform above functions for decades, but BPF helps us perform these tasks more efficiently. BPF programs use fewer CPU and memory resources than traditional solutions.</p><h2 id="how-is-bpf-faster">How is BPF faster?</h2><p>BPF programs are faster because BPF code runs in kernel space.</p><p>Consider the steps a program has to take to calculate the number of bytes sent out on a Linux system. First, the kernel generates raw data as network activity occurs. This raw data packs a ton of information, most of which is irrelevant for calculating <em>bytes out</em> metrics. So, whatever is generating aggregated metrics will have to  filter the relevant data points repeatedly and run mathematical calculations on them. This process is repeated hundreds of times (or more) every minute.</p><p>Since traditional monitoring programs run in user space, all that raw data that the kernel generates has to be copied from kernel space into user space. This data copy and filtering operation can be very taxing on the CPU. This is why <code>ptrace</code> is slow (whereas <code><a href="https://github.com/iovisor/bpftrace?ref=blog.realvarez.com">bpftrace</a></code> is not).</p><p>eBPF avoids this copying of data from kernel space to user space. You can run a program in kernel space to aggregate the data you need and send just the output to user space.</p><p>Before BPF, large amounts of raw data from the kernel had to be copied over to user space for analysis. BPF allows creating histograms and filtering data within the kernel, which is much faster than exchanging massive amounts of data between user and kernel space.</p><h2 id="bpf-maps">BPF Maps</h2><p>BPF uses <strong>BPF maps</strong> to allow bidirectional data exchange between user and kernel space. In Linux, maps are a generic storage type for sharing data between user and kernel space. They are key value stores that reside in the kernel.</p><h2 id="for-metrics-generation-bpf-programs-run-calculations-in-kernel-space-and-write-results-to-bpf-maps-that-a-userspace-application-can-read-and-also-write-to">For metrics generation, BPF programs run calculations in kernel space and write results to BPF maps that a userspace  application can read (and also write to).</h2><p>Now you know why eBPF is efficient. It’s because BPF provides a way to run programs in kernel space and avoid copying irrelevant data between kernel and userspace.</p><h2 id="references">References</h2><p><a href="https://thenewstack.io/how-ebpf-streamlines-the-service-mesh?ref=blog.realvarez.com">https://thenewstack.io/how-ebpf-streamlines-the-service-mesh</a></p><p><a href="https://buoyant.io/2022/06/07/ebpf-sidecars-and-the-future-of-the-service-mesh/?ref=blog.realvarez.com">https://buoyant.io/2022/06/07/ebpf-sidecars-and-the-future-of-the-service-mesh/</a></p><p><a href="https://av.tib.eu/media/44349?ref=blog.realvarez.com">https://av.tib.eu/media/44349</a><a href="https://www.amazon.com/Linux-Observability-BPF-Programming-Performance/dp/1492050202?ref=blog.realvarez.com">https://www.amazon.com/Linux-Observability-BPF-Programming-Performance/dp/1492050202</a></p><p><a href="https://www.amazon.com/Linux-Observability-BPF-Programming-Performance/dp/1492050202?ref=blog.realvarez.com">https://www.amazon.com/Linux-Observability-BPF-Programming-Performance/dp/1492050202</a></p>
</div>
<div class="container medium">
<div class="share u-hover-wrapper">
<a class="share-item share-facebook u-hover-item" href="https://www.facebook.com/sharer.php?u=https://realvz.github.io/blog/how-is-ebpf-efficient-for-observability/" target="_blank" rel="noopener"><i class="icon icon-facebook"></i></a>
<a class="share-item share-twitter u-hover-item" href="https://twitter.com/intent/tweet?url=https://realvz.github.io/blog/how-is-ebpf-efficient-for-observability/&text=How%20is%20eBPF%20efficient%20for%20observability" target="_blank" rel="noopener"><i class="icon icon-twitter"></i></a>
<a class="share-item share-pinterest u-hover-item" href="https://pinterest.com/pin/create/button/?url=https://realvz.github.io/blog/how-is-ebpf-efficient-for-observability/&media=&description=How%20is%20eBPF%20efficient%20for%20observability" target="_blank" rel="noopener" data-pin-do="none"><i class="icon icon-pinterest"></i></a>
<a class="share-item share-linkedin u-hover-item" href="https://www.linkedin.com/shareArticle?mini=true&url=https://realvz.github.io/blog/how-is-ebpf-efficient-for-observability/&title=How%20is%20eBPF%20efficient%20for%20observability" target="_blank" rel="noopener"><i class="icon icon-linkedin"></i></a>
<a class="share-item share-reddit u-hover-item" href="https://reddit.com/submit?url=https://realvz.github.io/blog/how-is-ebpf-efficient-for-observability/&title=How%20is%20eBPF%20efficient%20for%20observability" target="_blank" rel="noopener"><i class="icon icon-reddit"></i></a>
<a class="share-item share-tumblr u-hover-item" href="https://www.tumblr.com/widgets/share/tool?canonicalUrl=https://realvz.github.io/blog/how-is-ebpf-efficient-for-observability/&title=How%20is%20eBPF%20efficient%20for%20observability" target="_blank" rel="noopener"><i class="icon icon-tumblr"></i></a>
<a class="share-item share-vk u-hover-item" href="http://vk.com/share.php?url=https://realvz.github.io/blog/how-is-ebpf-efficient-for-observability/&title=How%20is%20eBPF%20efficient%20for%20observability" target="_blank" rel="noopener"><i class="icon icon-vk"></i></a>
<a class="share-item share-pocket u-hover-item" href="https://getpocket.com/edit?url=https://realvz.github.io/blog/how-is-ebpf-efficient-for-observability/" target="_blank" rel="noopener"><i class="icon icon-pocket"></i></a>
<a class="share-item share-telegram u-hover-item" href="https://t.me/share/url?url=https://realvz.github.io/blog/how-is-ebpf-efficient-for-observability/&text=How%20is%20eBPF%20efficient%20for%20observability" target="_blank" rel="noopener"><i class="icon icon-telegram"></i></a>
</div> </div>
</article>
<div class="navigation container medium">
<div class="navigation-item navigation-previous">
<a class="navigation-item-link button-arrow button-arrow-left" href="/weak-references-a-weapon-against-out-of-memory-errors/">
<i class="button-arrow-icon icon icon-arrow-left"></i> Previous Post
</a>
</div>
<div class="navigation-item navigation-next">
<a class="navigation-item-link button-arrow button-arrow-right" href="/handling-feedback/">
Next Post <i class="button-arrow-icon icon icon-arrow-right"></i>
</a>
</div>
</div> </main>
</div>
</div>
<footer class="site-footer container large">
<div class="copyright">
Powered by <a href="https://ghost.org/" target="_blank" rel="noopener">Ghost</a>
</div>
<nav class="footer-nav">
<ul class="nav-list u-plain-list">
<li class="menu-item menu-item-sign-up"><a class="menu-item-link" href="https://realvz.github.io/blog/#/portal/">Sign up</a></li>
</ul>
</nav>
<div class="footer-social">
<a class="footer-social-item footer-social-item-twitter" href="https://twitter.com/realz" target="_blank" rel="noopener" aria-label="Twitter">
<i class="icon icon-twitter"></i>
</a>
<a class="footer-social-item footer-social-item-rss" href="https://feedly.com/i/subscription/feed/https://realvz.github.io/blog/rss/" target="_blank" rel="noopener" aria-label="RSS">
<i class="icon icon-rss"></i>
</a>
</div>
</footer> </div>
<div class="dimmer"></div>
<div class="off-canvas">
<div class="canvas-close">
<i class="canvas-icon icon icon-window-close"></i>
</div>
<div class="mobile-menu"></div>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous">
    </script>
<script src="/assets/built/main.min.js?v=ce0a9a97d4"></script>
</body>
</html>